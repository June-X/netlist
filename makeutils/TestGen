#!/bin/bash

for test in $@ ; do
  imports="$imports
import Test.$test"
  if [ -z "$testmap" ] ; then
    testmap="testMap = M.fromList [(\"$test\",Test.$test.runTests)"
  else
    testmap="$testmap
                     ,(\"$test\",Test.$test.runTests)"
  fi
done

if [ -n "$testmap" ] ; then
  testmap="$testmap
                     ]"
fi

echo "
-- Autogenerated file: do not edit. Edit TestGen and/or Makefile instead
-- FIXME these names are NOT cabal friendly. Think of how somebody else
--   would use these packages/run tests etc.
import Data.Map as M
import System.Environment

$imports

$testmap

main = mapM_ (testMap !) =<< getArgs
"
